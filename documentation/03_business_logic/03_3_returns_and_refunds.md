# İş Mantığı: İade ve Geri Ödeme Süreçleri (RMA)

## 1. Genel Bakış ve Terminoloji

Bu doküman, bir Müşteri İade Talebi'nin (RMA - Return Merchandise Authorization) tüm yaşam döngüsünü, sistem ve yönetici perspektifinden tanımlar. Süreç, müşteri talebinin alınması, değerlendirilmesi, ürünün geri kabulü ve para iadesinin yapılmasını içerir.

- **İade Politikası:** Sistemin temel iş kuralı, iadelerin ürünün müşteriye teslim edilmesinden (`delivered` statüsü) sonraki **14 gün** içinde kabul edilmesidir. Bu kural, iade talebi butonunun kullanıcı arayüzünde gösterilip gösterilmemesini kontrol eder.
- **Geri Ödeme:** Para iadesi işlemleri, ödemenin aslen yapıldığı platform olan Stripe üzerinden API çağrıları ile yönetilecektir. Bu, güvenli ve takibi kolay bir süreç sağlar.

## 2. İade Yönetim Akışı (Admin Paneli Perspektifi)

Bu akış, bir iade talebinin yönetici panelinde nasıl göründüğünü ve hangi adımlarla ilerlediğini gösterir.

| Adım | Statü (Önce -> Sonra)                 | Aksiyon (Yönetici / Sistem)                                                                                                                                                                                                                               | Müşteriye Etkisi                                                                                                                         |
| :--- | :------------------------------------ | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------- |
| 1    | (Yok) -> `pending_approval`           | Müşteri, "Hesabım" panelinden bir iade talebi oluşturur. Sistem, `returns` tablosunda yeni bir kayıt oluşturur. Talep, Yönetici Paneli'ndeki "İade Talepleri" listesine düşer.                                                                             | Müşteri, talebinin alındığına dair bir onay mesajı görür ve "Hesabım" -> "İadelerim" altında talebini takip edebilir.                     |
| 2    | `pending_approval` -> `approved`      | Yönetici, talebi inceler ve "Onayla" butonuna tıklar. Sistem, `returns` tablosunun durumunu günceller.                                                                                                                                                       | Müşteriye, talebinin onaylandığını ve ürünü nasıl geri göndereceğine dair talimatları (örn: iade adresi, kargo kodu) içeren bir e-posta gönderilir. |
| 3    | `pending_approval` -> `rejected`      | Yönetici, talebi inceler ve iade politikasına uymadığına karar verirse (örn: 14 günü geçmiş), "Reddet" butonuna tıklar. Açılan pencereye reddetme nedenini yazar.                                                                                              | Müşteriye, iade talebinin neden reddedildiğini açıklayan bir e-posta gönderilir. Süreç burada sonlanır.                                 |
| 4    | `approved` -> `received`              | Müşterinin gönderdiği iade paketi depoya ulaşır. Yönetici, paketi açıp kontrol eder ve panelden ilgili iade talebini bularak "Teslim Alındı" olarak işaretler.                                                                                                   | Müşterinin "İadelerim" sayfasındaki talep durumu güncellenir.                                                                            |
| 5    | `received` -> `refund_processed`      | Yönetici, iade edilen ürünlerin durumunu (tekrar satılabilir mi?) değerlendirir ve "Geri Ödemeyi Başlat" butonuna tıklar. Bu aksiyon, iki önemli işlemi tetikler:                                                                                             | -                                                                                                                                        |
| 5a   | -                                     | **1. Stok Güncelleme:** Eğer ürünler satılabilir durumdaysa, yönetici "Stoğa Geri Ekle" seçeneğini işaretler. Bu, `Envanter Yönetimi` mantığını çalıştırarak ilgili ürünlerin stoğunu artırır.                                                               | -                                                                                                                                        |
| 5b   | -                                     | **2. Para İadesi:** Sistem, arka planda Stripe API'ını çağırır. Siparişin orijinal `payment_intent_id`'si kullanılarak müşteriye para iadesi (tam veya kısmi) yapılır.                                                                                          | -                                                                                                                                        |
| 6    | `refund_processed`                    | Stripe'tan başarılı bir geri ödeme onayı alındığında, sistem `returns` tablosunun durumunu `refund_processed` olarak günceller.                                                                                                                               | Müşteriye, para iadesinin başarıyla işleme alındığına dair son bir onay e-postası gönderilir. Süreç tamamlanır.                      | 